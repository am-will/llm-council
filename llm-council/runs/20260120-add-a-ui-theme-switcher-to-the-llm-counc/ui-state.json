{
  "errors": [],
  "final_plan": "Test\n\n# Plan\n\n## Overview\nAdd a popup theme switcher scoped to the llm-council skill UI by applying theme-specific CSS variables to the skill’s root container and persisting the selection in localStorage. Extend the neo brutalism theme with a dark variant while keeping changes self-contained.\n\n## Scope\n- In:\n  - Popup theme switcher UI (button + menu/dialog)\n  - Theme presets (light, dark, system) via CSS variables\n  - Dark mode variant for the neo brutalism theme\n  - LocalStorage persistence scoped to llm-council UI\n  - Keyboard/ARIA basics for the popup\n- Out:\n  - Global theme changes outside this skill UI\n  - Server-side persistence\n  - New build tooling\n\n## Phases\n### Phase 1: Confirm UI entry points and scoping\n**Goal**: Locate the correct UI files and root container to scope theme changes.\n\n#### Task 1.1: Verify UI files and root element\n- Location: `scripts/ui/index.html`, `scripts/ui/app.js`, `scripts/ui/styles.css` (confirm)\n- Description: Identify the root element to scope theming (e.g., a wrapper div) and the existing CSS variable system.\n- Estimated Tokens: 200\n- Dependencies: None\n- Steps:\n  - Inspect the UI HTML to find the top-level container.\n  - Scan CSS for existing color variables, theme classes, and hardcoded colors.\n- Acceptance Criteria:\n  - Root container is identified for scoping (e.g., `.llm-council-root` or a unique data attribute).\n  - A list of theme-relevant variables and existing theme hooks is captured.\n\n### Phase 2: Theme variables and base styles\n**Goal**: Define light/dark/system themes using scoped CSS variables.\n\n#### Task 2.1: Add theme variable blocks\n- Location: `scripts/ui/styles.css` (or existing style block)\n- Description: Define scoped CSS variables for light/dark/system under the root container using a `data-theme` attribute.\n- Estimated Tokens: 400\n- Dependencies: Task 1.1\n- Steps:\n  - Add `[data-theme=\"light\"]`, `[data-theme=\"dark\"]` under the root selector.\n  - For system, rely on `prefers-color-scheme` when `data-theme=\"system\"` or no explicit theme.\n  - Replace any hardcoded colors with variables if needed for coverage.\n- Acceptance Criteria:\n  - Toggling `data-theme` on the root visually changes the UI.\n  - Theme variables do not affect other skills.\n\n#### Task 2.2: Add neo brutalism dark variant\n- Location: `scripts/ui/styles.css`\n- Description: Define dark-mode variables (or modifier class) for the neo brutalism theme so it stays on-brand while increasing contrast.\n- Estimated Tokens: 300\n- Dependencies: Task 2.1\n- Steps:\n  - Locate existing neo brutalism theme selectors/variables.\n  - Add a dark variant tied to `data-theme=\"dark\"` (or a `data-theme` + theme class combo).\n  - Ensure key elements (backgrounds, borders, shadows, accents) update appropriately.\n- Acceptance Criteria:\n  - Neo brutalism theme renders correctly in dark mode with readable contrast.\n  - No regressions in light mode visuals.\n\n### Phase 3: Popup switcher UI\n**Goal**: Provide a popup for users to pick a theme.\n\n#### Task 3.1: Add button and popup markup\n- Location: `scripts/ui/index.html`\n- Description: Insert a Theme button in the header and a hidden menu/popup with options.\n- Estimated Tokens: 300\n- Dependencies: Task 1.1\n- Steps:\n  - Add a button in the existing header controls.\n  - Add a popup container with three options: Light, Dark, System.\n- Acceptance Criteria:\n  - Button and popup exist and are correctly positioned.\n\n#### Task 3.2: Wire popup behavior and persistence\n- Location: `scripts/ui/app.js`\n- Description: Toggle popup visibility, apply selected theme to root, and persist via localStorage.\n- Estimated Tokens: 500\n- Dependencies: Task 3.1, Task 2.1\n- Steps:\n  - On load, read `localStorage` key (e.g., `llm-council-ui-theme`) and apply to root.\n  - Toggle popup open/close with click and Escape.\n  - Apply selected theme and close popup; handle click outside.\n  - If theme is `system`, react to `matchMedia` changes.\n- Acceptance Criteria:\n  - Theme applies immediately and persists on reload.\n  - Popup opens/closes reliably with mouse and keyboard.\n\n## Testing Strategy\n- Manual: Switch themes and confirm immediate visual changes.\n- Manual: Refresh page and confirm persistence.\n- Manual: Verify popup closes on Escape/click outside and focus returns to the button.\n- Manual: Confirm neo brutalism theme in dark mode remains readable and on-brand.\n- Manual: Confirm other skills’ UIs are unaffected.\n\n## Risks\n- Risk: Some colors are hardcoded and won’t update in themes.\n  - Mitigation: Audit CSS and migrate hardcoded colors to variables used by themes.\n- Risk: Neo brutalism dark variant reduces contrast or loses visual identity.\n  - Mitigation: Tune accent colors and borders for contrast while preserving the theme’s bold palette.\n\n## Rollback Plan\n- Remove popup markup from `scripts/ui/index.html`.\n- Remove theme logic from `scripts/ui/app.js`.\n- Remove theme variable blocks and neo brutalism dark variant from `scripts/ui/styles.css`.\n\n## Edge Cases\n- localStorage blocked: fall back to default theme without crashing.\n- System theme changes while “System” is selected: update via `matchMedia` listener.\n- Popup clipping: ensure it is positioned outside any overflow-hidden container.\n\n## Open Questions\n- None.",
  "judge": {
    "errors": [],
    "status": "complete",
    "summary": "# Judge Report\n\n## Scores\n- Plan 1: 7.5/10\n- Plan 2: 6.5/10\n- Plan 3: 7/10 (if present)\n\n## Comparative Analysis\nPlan 1 is concise and feasible for a likely static UI (index.html + app.js) and keeps scope tight. Plan 3 is similar but adds a high-contrast theme and more edge handling; slightly more complete but also adds extra themes without requirement. Plan 2 is thorough but assumes a React app and introduces extra files and complexity; feasibility is lower without confirming the UI stack.\n\n## Missing Steps\n- Verify actual UI stack and file locations before choosing React vs vanilla implementation.\n- Identify the true UI root element to scope theme variables so the change only affects this skill UI.\n- Audit existing color usage to ensure themes cover all hardcoded colors.\n- Define accessibility attributes/roles for popup/menu and focus management.\n\n## Contradictions\n- Framework assumptions conflict: Plan 2 assumes React; Plans 1/3 assume vanilla HTML/JS/CSS.\n- Theme set differences: Plan 2 uses light/dark/system; Plan 3 adds high-contrast; Plan 1 leaves number unspecified.\n\n## Improvements\n- Start with a quick codebase scan to confirm entry points and CSS strategy, then pick the simplest implementation.\n- Use a unique data attribute or class on the skill UI root to scope theme variables.\n- Add minimal ARIA and keyboard support to the popup (Escape to close, focus return).\n- Keep theme list to required presets unless explicitly requested.\n\n## Final Plan\n\n# Plan\n\n## Overview\nAdd a popup theme switcher scoped to the llm-council skill UI by applying theme-specific CSS variables to the skill’s root container and persisting the selection in localStorage. Implement in the existing UI stack (likely `scripts/ui/*`), keeping changes self-contained.\n\n## Scope\n- In:\n  - Popup theme switcher UI (button + menu/dialog)\n  - Theme presets (light, dark, system) via CSS variables\n  - LocalStorage persistence scoped to llm-council UI\n  - Keyboard/ARIA basics for the popup\n- Out:\n  - Global theme changes outside this skill UI\n  - Server-side persistence\n  - New build tooling\n\n## Phases\n### Phase 1: Confirm UI entry points and scoping\n**Goal**: Locate the correct UI files and root container to scope theme changes.\n\n#### Task 1.1: Verify UI files and root element\n- Location: `scripts/ui/index.html`, `scripts/ui/app.js`, `scripts/ui/styles.css` (confirm)\n- Description: Identify the root element to scope theming (e.g., a wrapper div) and the existing CSS variable system.\n- Estimated Tokens: 200\n- Dependencies: None\n- Steps:\n  - Inspect the UI HTML to find the top-level container.\n  - Scan CSS for existing color variables and hardcoded colors.\n- Acceptance Criteria:\n  - Root container is identified for scoping (e.g., `.llm-council-root` or a unique data attribute).\n  - A list of theme-relevant variables is captured.\n\n### Phase 2: Theme variables and base styles\n**Goal**: Define light/dark/system themes using scoped CSS variables.\n\n#### Task 2.1: Add theme variable blocks\n- Location: `scripts/ui/styles.css` (or existing style block)\n- Description: Define scoped CSS variables for light/dark/system under the root container using a `data-theme` attribute.\n- Estimated Tokens: 400\n- Dependencies: Task 1.1\n- Steps:\n  - Add `[data-theme=\"light\"]`, `[data-theme=\"dark\"]` under the root selector.\n  - For system, rely on `prefers-color-scheme` when `data-theme=\"system\"` or no explicit theme.\n  - Replace any hardcoded colors with variables if needed for coverage.\n- Acceptance Criteria:\n  - Toggling `data-theme` on the root visually changes the UI.\n  - Theme variables do not affect other skills.\n\n### Phase 3: Popup switcher UI\n**Goal**: Provide a popup for users to pick a theme.\n\n#### Task 3.1: Add button and popup markup\n- Location: `scripts/ui/index.html`\n- Description: Insert a Theme button in the header and a hidden menu/popup with options.\n- Estimated Tokens: 300\n- Dependencies: Task 1.1\n- Steps:\n  - Add a button in the existing header controls.\n  - Add a popup container with three options: Light, Dark, System.\n- Acceptance Criteria:\n  - Button and popup exist and are correctly positioned.\n\n#### Task 3.2: Wire popup behavior and persistence\n- Location: `scripts/ui/app.js`\n- Description: Toggle popup visibility, apply selected theme to root, and persist via localStorage.\n- Estimated Tokens: 500\n- Dependencies: Task 3.1, Task 2.1\n- Steps:\n  - On load, read `localStorage` key (e.g., `llm-council-ui-theme`) and apply to root.\n  - Toggle popup open/close with click and Escape.\n  - Apply selected theme and close popup; handle click outside.\n  - If theme is `system`, react to `matchMedia` changes.\n- Acceptance Criteria:\n  - Theme applies immediately and persists on reload.\n  - Popup opens/closes reliably with mouse and keyboard.\n\n## Testing Strategy\n- Manual: Switch themes and confirm immediate visual changes.\n- Manual: Refresh page and confirm persistence.\n- Manual: Verify popup closes on Escape/click outside and focus returns to the button.\n- Manual: Confirm other skills’ UIs are unaffected.\n\n## Risks\n- Risk: Some colors are hardcoded and won’t update in themes.\n  - Mitigation: Audit CSS and migrate hardcoded colors to variables used by themes.\n\n## Rollback Plan\n- Remove popup markup from `scripts/ui/index.html`.\n- Remove theme logic from `scripts/ui/app.js`.\n- Remove theme variable blocks from `scripts/ui/styles.css`.\n\n## Edge Cases\n- localStorage blocked: fall back to default theme without crashing.\n- System theme changes while “System” is selected: update via `matchMedia` listener.\n- Popup clipping: ensure it is positioned outside any overflow-hidden container.\n\n## Open Questions\n- None."
  },
  "keep_open": false,
  "phase": "complete",
  "planners": [
    {
      "errors": [],
      "id": "claude-2",
      "status": "complete",
      "summary": "# Plan\n\n## Overview\nAdd a self-contained theme switcher component to the llm-council skill UI that allows users to toggle between themes (e.g., light, dark, system) via a popup interface. The theme state will be scoped to this skill UI only using CSS custom properties and local storage for persistence.\n\n## Scope\n- In:\n  - Theme switcher popup component with theme options (light, dark, system)\n  - CSS custom properties for theme variables scoped to the skill UI root\n  - Local storage persistence keyed specifically to llm-council skill\n  - Visual indicator of current theme in the UI\n  - Smooth transition between themes\n- Out:\n  - Global/system-wide theme changes affecting other skills or applications\n  - Theme customization beyond predefined presets\n  - Server-side theme storage or user account sync\n\n## Phases\n\n### Phase 1: Theme Infrastructure\n**Goal**: Establish CSS custom properties and theme definitions scoped to the skill UI.\n\n#### Task 1.1: Define theme CSS variables\n- Location: `ui/src/styles/themes.css` (new file), `ui/src/index.css` or equivalent root styles\n- Description: Create CSS custom property definitions for light, dark, and system themes covering colors, backgrounds, borders, and text. Scope variables under a `.llm-council-root` or similar container class.\n- Estimated Tokens: 2000\n- Dependencies: None\n- Steps:\n  - Create `themes.css` with `:root` and `[data-theme=\"light\"]`, `[data-theme=\"dark\"]` selectors\n  - Define variables: `--lc-bg-primary`, `--lc-bg-secondary`, `--lc-text-primary`, `--lc-text-secondary`, `--lc-border`, `--lc-accent`, etc.\n  - Add `prefers-color-scheme` media query for system theme fallback\n  - Import `themes.css` in the skill UI's root style entry point\n- Acceptance Criteria:\n  - Changing `data-theme` attribute on skill UI container switches visual theme\n  - Variables are namespaced to avoid conflicts with other skills\n\n#### Task 1.2: Create theme context/state management\n- Location: `ui/src/context/ThemeContext.tsx` (new file) or `ui/src/hooks/useTheme.ts`\n- Description: Implement React context or hook to manage theme state, read/write to local storage with a skill-specific key, and apply `data-theme` attribute to the skill UI container.\n- Estimated Tokens: 2500\n- Dependencies: Task 1.1\n- Steps:\n  - Create `ThemeContext` with `theme` state and `setTheme` function\n  - Initialize from `localStorage.getItem('llm-council-theme')` or default to 'system'\n  - On theme change, update `localStorage` and set `data-theme` attribute on container element\n  - Handle 'system' theme by detecting `prefers-color-scheme` and adding media query listener\n  - Export `ThemeProvider` and `useTheme` hook\n- Acceptance Criteria:\n  - Theme persists across page reloads\n  - 'system' theme responds to OS preference changes in real-time\n  - State is isolated to llm-council skill UI container only\n\n### Phase 2: Theme Switcher Component\n**Goal**: Build the popup UI component for theme selection.\n\n#### Task 2.1: Create ThemeSwitcher popup component\n- Location: `ui/src/components/ThemeSwitcher.tsx` (new file), `ui/src/components/ThemeSwitcher.css`\n- Description: Build a button that opens a popup/dropdown with theme options. Include icons or labels for each theme. Handle click-outside to close.\n- Estimated Tokens: 3000\n- Dependencies: Task 1.2\n- Steps:\n  - Create `ThemeSwitcher` component with `isOpen` state for popup visibility\n  - Add trigger button (icon showing current theme, e.g., sun/moon/auto)\n  - Render popup with three options: Light, Dark, System\n  - Highlight currently selected theme\n  - Use `useTheme` hook to get/set theme\n  - Implement click-outside detection to close popup\n  - Add keyboard accessibility (Escape to close, arrow keys for navigation)\n  - Style with CSS using theme variables for self-theming\n- Acceptance Criteria:\n  - Popup opens on button click and closes on selection or click-outside\n  - Selected theme is visually indicated\n  - Component is keyboard accessible\n  - Smooth open/close animation\n\n#### Task 2.2: Integrate ThemeSwitcher into skill UI layout\n- Location: `ui/src/App.tsx` or main layout component, `ui/src/components/Header.tsx` if exists\n- Description: Add ThemeProvider wrapper and place ThemeSwitcher component in an appropriate UI location (e.g., header, toolbar, or corner).\n- Estimated Tokens: 1500\n- Dependencies: Task 2.1\n- Steps:\n  - Wrap skill UI root component with `ThemeProvider`\n  - Add `data-theme` attribute binding to root container element\n  - Place `ThemeSwitcher` in header/toolbar area\n  - Ensure z-index and positioning don't conflict with other UI elements\n- Acceptance Criteria:\n  - Theme switcher is visible and accessible in the UI\n  - Theme changes apply immediately to entire skill UI\n  - No visual regressions in existing components\n\n### Phase 3: Polish and Testing\n**Goal**: Ensure robustness, accessibility, and smooth UX.\n\n#### Task 3.1: Update existing components to use theme variables\n- Location: All component CSS files in `ui/src/components/`\n- Description: Replace hardcoded colors with CSS custom properties to ensure all UI elements respond to theme changes.\n- Estimated Tokens: 3000\n- Dependencies: Task 2.2\n- Steps:\n  - Audit existing component styles for hardcoded colors\n  - Replace with corresponding `--lc-*` variables\n  - Test each component in both light and dark themes\n  - Fix any contrast or readability issues\n- Acceptance Criteria:\n  - All components properly themed in light and dark modes\n  - No hardcoded colors remain in component styles\n  - WCAG AA contrast ratios maintained in all themes\n\n#### Task 3.2: Add transition animations\n- Location: `ui/src/styles/themes.css`\n- Description: Add smooth CSS transitions when switching themes to avoid jarring visual changes.\n- Estimated Tokens: 500\n- Dependencies: Task 3.1\n- Steps:\n  - Add `transition: background-color 0.2s, color 0.2s, border-color 0.2s` to themed elements\n  - Use `@media (prefers-reduced-motion: reduce)` to disable for accessibility\n- Acceptance Criteria:\n  - Theme transitions are smooth (0.2-0.3s)\n  - Reduced motion preference is respected\n\n## Testing Strategy\n- Unit tests for `useTheme` hook: verify state changes, localStorage reads/writes, system preference detection\n- Component tests for `ThemeSwitcher`: verify popup opens/closes, theme selection triggers callback, keyboard navigation works\n- Integration test: verify theme persists across simulated page reload\n- Visual regression test: screenshot comparison of UI in light vs dark themes\n- Manual testing: verify theme isolation (other skills unaffected), test system theme with OS preference toggle\n- Accessibility audit: verify focus management, ARIA attributes on popup, color contrast in all themes\n\n## Risks\n- **Risk**: CSS variable scoping leaks to other skills if not properly namespaced.\n  - Mitigation: Use unique prefix (`--lc-`) and scope all theme styles under a container class/attribute selector.\n- **Risk**: Local storage key collision with other skills or future features.\n  - Mitigation: Use fully qualified key `llm-council-ui-theme` with skill identifier.\n- **Risk**: System theme detection fails silently in unsupported browsers.\n  - Mitigation: Graceful fallback to light theme; feature-detect `matchMedia` support.\n- **Self-critique**: The plan assumes React is the UI framework but doesn't verify this from the codebase—if the skill uses a different framework (Vue, Svelte, vanilla JS), the implementation approach for context/hooks would need significant changes.\n- **Self-critique**: The plan doesn't account for SSR/hydration scenarios—if the UI is server-rendered, the initial theme flash (FOUC) could be jarring. Would need a blocking script or cookie-based approach to prevent flash.\n\n## Rollback Plan\n- Revert commits adding theme infrastructure (`themes.css`, `ThemeContext.tsx`, `ThemeSwitcher.tsx`)\n- Remove `ThemeProvider` wrapper and `ThemeSwitcher` from layout\n- Remove CSS variable references from component styles (restore original colors)\n- Clear `llm-council-ui-theme` from localStorage in a cleanup migration if needed\n- All changes are additive and isolated, so revert is straightforward via git\n\n## Edge Cases\n- User has localStorage disabled: fall back to in-memory state, theme won't persist\n- User switches OS theme while 'system' is selected: must update in real-time via `matchMedia` listener\n- Popup opens near viewport edge: ensure positioning logic prevents overflow\n- Multiple tabs open: consider `storage` event listener to sync theme across tabs (optional enhancement)\n- Theme CSS fails to load: ensure base styles provide readable fallback\n- User rapidly toggles themes: debounce or ensure transitions don't stack/conflict\n\n## Open Questions\n- None—the brief provides sufficient direction for a self-contained implementation."
    },
    {
      "errors": [],
      "id": "codex-1",
      "status": "complete",
      "summary": "# Plan\n\n## Overview\nAdd a modal theme switcher to the LLM Council UI that lets users pick among defined themes by swapping CSS variables scoped to this UI, with persistence via localStorage.\n\n## Scope\n- In: Modal theme switcher UI, theme definitions via CSS variables, apply/persist theme selection in client JS.\n- Out: Server-side changes, shared/global theming across other skills, new build tooling.\n\n## Phases\n### Phase 1: Theme Switcher UI & Styling\n**Goal**: Add a pop-up theme picker and theme variable sets scoped to this UI.\n\n#### Task 1.1: Add modal markup and trigger button\n- Location: scripts/ui/index.html\n- Description: Add a “Theme” button in the header controls and a hidden modal container with theme options.\n- Estimated Tokens: 400\n- Dependencies: None\n- Steps:\n  - Insert a theme trigger button in the header/status controls area.\n  - Add modal HTML structure near the end of body (overlay + panel + theme option buttons + close).\n- Acceptance Criteria:\n  - Theme modal opens via button and closes via overlay/close action.\n\n#### Task 1.2: Define theme variable sets and modal styling\n- Location: scripts/ui/index.html (inline `<style>`)\n- Description: Add CSS for modal and per-theme CSS variables on `:root[data-theme=\"...\"]`.\n- Estimated Tokens: 600\n- Dependencies: Task 1.1\n- Steps:\n  - Add modal layout styling (overlay, panel, focusable buttons).\n  - Define 3+ themes by overriding existing CSS variables (e.g., `--bg`, `--ink`, `--accent`).\n- Acceptance Criteria:\n  - Changing `data-theme` on the root updates UI colors consistently.\n\n### Phase 2: Theme Selection Logic & Persistence\n**Goal**: Wire UI actions to apply and persist theme selection.\n\n#### Task 2.1: Implement theme switcher behavior\n- Location: scripts/ui/app.js\n- Description: Add handlers for opening/closing the modal, applying a theme, and storing it locally.\n- Estimated Tokens: 500\n- Dependencies: Task 1.1, Task 1.2\n- Steps:\n  - Read saved theme from localStorage on load and set `document.documentElement.dataset.theme`.\n  - Add click handlers to theme buttons to apply theme + persist.\n  - Add close handlers (close button, overlay click, Escape key).\n- Acceptance Criteria:\n  - Selected theme persists on reload; modal behaves predictably.\n\n## Testing Strategy\n- Manual: Run UI server, open UI, switch themes, refresh page, confirm persistence.\n- Manual: Verify theme switcher affects only UI visuals and does not change API behavior/state.\n- Manual: Check modal open/close with button, overlay click, and Escape.\n\n## Risks\n- Risk: Conflicting or unused CSS sources (inline vs `styles.css`) could cause inconsistent theming. Mitigation: keep all theme variables in the active inline CSS and avoid introducing new CSS files.\n- Risk: Theme variable coverage may miss some colors, leaving mixed styling. Mitigation: audit all CSS vars and ensure each theme overrides the full set used by the UI.\n- Self-critique: The plan assumes the inline `<style>` is the authoritative stylesheet; if the UI later switches to `styles.css`, updates may not apply.\n- Self-critique: The plan does not include a full accessibility audit (contrast ratios, focus trapping), which could leave the modal partially inaccessible.\n\n## Rollback Plan\n- Remove modal HTML and theme button from scripts/ui/index.html.\n- Remove theme-related CSS and JS logic from scripts/ui/index.html and scripts/ui/app.js.\n\n## Edge Cases\n- localStorage unavailable or blocked: fall back to default theme without errors.\n- SSE updates while modal open: UI should remain responsive and not auto-close modal.\n- Theme switch during active edits: ensure editor state remains unchanged.\n\n## Open Questions\n- None."
    },
    {
      "errors": [],
      "id": "gemini-3",
      "status": "complete",
      "summary": "# Plan\n\n## Overview\nImplement a client-side theme switcher mechanism in the `llm-council` skill UI. This involves defining new CSS theme classes (Dark, High Contrast) that override existing CSS variables, adding a \"Theme\" button to the header which triggers a popup menu for selection, and using `localStorage` to persist the user's preference across sessions.\n\n## Scope\n- In:\n  - CSS definitions for 'Dark' and 'High Contrast' themes.\n  - HTML markup for the theme switcher button and popup menu in `index.html`.\n  - JavaScript logic to handle toggling the popup, applying selected themes, and persisting state to `localStorage`.\n- Out:\n  - Backend persistence (themes are a local user preference).\n  - Changes to other skills or global system configurations.\n\n## Phases\n### Phase 1: Theme Styles\n**Goal**: Define visual themes using CSS variables to ensure consistent styling across the application.\n\n#### Task 1.1: CSS Theme Definitions\n- Location: `scripts/ui/styles.css`\n- Description: Add `.theme-dark` and `.theme-contrast` classes attached to the `:root` or `body` scope. Override specific variables (`--bg`, `--ink`, `--panel`, `--accent`, etc.) to create distinct, accessible visual styles. Ensure complex background gradients are adjusted or simplified for dark mode.\n- Estimated Tokens: 400\n- Dependencies: None\n- Steps:\n  - Analyze existing variables to identify all necessary overrides.\n  - Create `.theme-dark` with inverted colors (dark bg, light text) and adjusted shadows.\n  - Create `.theme-contrast` with high contrast ratios (white/black, thick borders).\n- Acceptance Criteria:\n  - Manually applying the class `theme-dark` to the `<html>` tag changes the UI to a dark theme.\n  - Manually applying `theme-contrast` changes the UI to a high-contrast theme.\n\n### Phase 2: UI Implementation & Logic\n**Goal**: Add the interactive elements and logic to allow users to switch themes.\n\n#### Task 2.1: Add Switcher Component\n- Location: `scripts/ui/index.html`\n- Description: Add a \"Theme\" button to the `.status-controls` section of the header. Add a hidden `dialog` or absolute-positioned `div` container for the theme selection menu (Radio buttons or list items).\n- Estimated Tokens: 300\n- Dependencies: None\n- Steps:\n  - Insert a `<button>` element inside `.status-controls`.\n  - Add the menu markup (e.g., `<div id=\"themeMenu\" hidden>...</div>`) containing options for 'System', 'Light', 'Dark', 'Contrast'.\n- Acceptance Criteria:\n  - The \"Theme\" button appears in the header.\n  - The menu markup is present but hidden by default.\n\n#### Task 2.2: Implement Switcher Logic\n- Location: `scripts/ui/app.js`\n- Description: Implement the logic to toggle the menu visibility, handle theme selection, apply the class to `document.documentElement`, and save/load from `localStorage`.\n- Estimated Tokens: 500\n- Dependencies: Task 1.1, Task 2.1\n- Steps:\n  - Initialize theme on load: Check `localStorage` first, then `window.matchMedia('(prefers-color-scheme: dark)')`.\n  - Add event listener to the \"Theme\" button to toggle the menu visibility.\n  - Add event listeners to menu options to apply the selected theme and close the menu.\n  - Save selection to `localStorage`.\n  - Handle \"click outside\" to close the menu.\n- Acceptance Criteria:\n  - Clicking \"Theme\" opens the menu.\n  - Selecting a theme updates the UI immediately.\n  - Refreshing the page retains the selected theme.\n\n## Testing Strategy\n- **Visual Validation**: Manually cycle through all themes to ensure all text is readable and no UI elements are broken (especially shadows and borders in Dark mode).\n- **Persistence Test**: Select a non-default theme, reload the page, and verify the theme persists.\n- **Interaction Test**: Verify the menu closes when clicking outside of it or selecting an option.\n\n## Risks\n- **Visual Regression**: Dark mode might make standard shadows invisible or look \"muddy\" against a dark background.\n  - *Mitigation*: Redefine `--shadow` and `--panel-shadow` variables specifically for the dark theme block (e.g., using lighter or colored shadows, or relying more on borders).\n- **Self-critique 1**: The plan assumes existing CSS variables cover all color usages. If hardcoded colors exist in `styles.css` (outside variables), they won't update.\n  - *Mitigation*: Grep `styles.css` for hex codes and `rgb/a` values to ensure everything is tokenized into variables before starting Phase 1.\n- **Self-critique 2**: The \"popup\" might be clipped if the header `overflow` is hidden or if z-index stacking context is tricky.\n  - *Mitigation*: Use a native `<dialog>` element or ensure the popup is appended to `body` and positioned absolutely to avoid overflow issues, or check header CSS to ensure `overflow: visible`.\n\n## Rollback Plan\n- Revert changes to `scripts/ui/index.html`, `scripts/ui/styles.css`, and `scripts/ui/app.js` to their previous git state.\n\n## Edge Cases\n- **No LocalStorage**: If `localStorage` is disabled (e.g., privacy mode), catch the exception and fall back to the session-only or default theme without crashing.\n- **System Preference Change**: If the user selects \"System\" (or hasn't selected anything) and changes their OS theme while the app is open, listen to the `matchMedia` change event to update dynamically.\n\n## Open Questions\n- None."
    }
  ],
  "run_id": "20260120-add-a-ui-theme-switcher-to-the-llm-counc",
  "task_brief": "",
  "timestamps": {
    "started_at": "",
    "updated_at": "2026-01-20T22:13:52.485929+00:00"
  },
  "ui_deadline": "2026-01-20T22:43:52.485910+00:00"
}